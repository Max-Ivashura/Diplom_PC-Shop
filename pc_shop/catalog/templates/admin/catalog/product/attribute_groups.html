<!-- templates/admin/catalog/product/attribute_groups.html -->
{% load custom_filters %}
<div class="accordion" id="attributeGroupsAccordion">
    {% for group in attribute_groups %}
    <div class="accordion-item">
        <h2 class="accordion-header">
            <button class="accordion-button {% if not forloop.first %}collapsed{% endif %}"
                    data-bs-toggle="collapse"
                    data-bs-target="#group{{ group.id }}">
                {{ group.name }}
                <span class="group-order badge bg-secondary">{{ group.order }}</span>
            </button>
        </h2>
        <div id="group{{ group.id }}"
             class="accordion-collapse collapse {% if forloop.first %}show{% endif %}"
             data-bs-parent="#attributeGroupsAccordion">
            <div class="accordion-body">
                <div class="attribute-list">
                    {% for attribute in group.attributes_sorted %}
                    <div class="attribute-row" data-attribute-id="{{ attribute.id }}">
                        <div class="attribute-header">
                            <span class="attribute-name">{{ attribute.name }}</span>
                            <span class="attribute-order badge bg-light text-dark">{{ attribute.order }}</span>
                        </div>
                        <div class="attribute-value">
                            {% with value=original.attribute_values_dict|get:attribute.id|stringformat:"i" %}
                            <input type="text"
                                   name="attribute_{{ attribute.id }}"
                                   value="{{ value.get_value|default:'' }}"
                                   class="form-control"
                                   data-attribute-type="{{ attribute.attribute_type }}">
                            {% endwith %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>